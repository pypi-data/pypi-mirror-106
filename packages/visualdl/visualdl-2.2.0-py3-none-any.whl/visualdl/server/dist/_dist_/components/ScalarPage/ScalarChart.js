function R(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(m){return Object.getOwnPropertyDescriptor(e,m).enumerable})),o.push.apply(o,a)}return o}function S(e){for(var t=1;t<arguments.length;t++){var o=arguments[t]!=null?arguments[t]:{};t%2?R(Object(o),!0).forEach(function(a){J(e,a,o[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):R(Object(o)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(o,a))})}return e}function J(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}import i,{useCallback as E,useMemo as c}from"../../../web_modules/react.js";import Q,{DownloadDataTypes as Y,chartSize as u,chartSizeInRem as T}from"../ScalarChart.js";import{XAxis as Z,chartData as V,nearestPoint as ee,singlePointRange as x,sortingMethodMap as te,tooltip as ae,xAxisMap as $}from"../../resource/scalar/index.js";import L from"../Chart.js";import{Chart as q}from"../Loader/ChartPage.js";import{XAxisType as f}from"../LineChart.js";import{cycleFetcher as re}from"../../utils/fetch.js";import F from"../../../web_modules/query-string.js";import ne from"../../utils/saveFile.js";import oe from"../../../web_modules/styled-components.js";import{useRunningRequest as se}from"../../hooks/useRequest.js";import{useTranslation as le}from"../../../web_modules/react-i18next.js";import y from"../../hooks/useWebAssembly.js";const ie=oe.div.withConfig({displayName:"ScalarChart__Error",componentId:"sc-1caty5y-0"})(["width:100%;height:100%;display:flex;justify-content:center;align-items:center;"]),ce=({runs:e,tag:t,smoothing:o,xAxis:a,sortingMethod:m,outlier:b,smoothedOnly:j,showMostValue:v,running:M})=>{const{t:z,i18n:w}=le(["scalar","common"]),{data:d,error:W,loading:I}=se(e.map(r=>`/scalar/list?${F.stringify({run:r.label,tag:t})}`),!!M,(...r)=>re(r)),h=c(()=>a===Z.WallTime?f.time:f.value,[a]),X=c(()=>{var r;return[(r=d==null?void 0:d.map(s=>s!=null?s:[]))!==null&&r!==void 0?r:[],o]},[d,o]),{data:p}=y("scalar_transform",X),n=c(()=>p!=null?p:[],[p]),k=c(()=>[n,!!b],[n,b]),{data:O}=y("scalar_axis_range",k),K=c(()=>[n],[n]),{data:l}=y("scalar_range",K),P=c(()=>{let r,s=O;return n.length===1&&n[0].length===1&&([f.value,f.log].includes(h)&&(r=x(n[0][0][$[a]])),s=x(n[0][0][2])),{x:r,y:s}},[n,O,h,a]),D=c(()=>V({data:n.slice(0,e.length),ranges:v?l!=null?l:[]:[],runs:e,xAxis:a,smoothedOnly:j}),[n,l,e,a,j,v]),_=c(()=>String(Math.max(...n.map(r=>Math.max(...r.map(s=>s[1]))))).length,[n]),N=E(r=>{const s=$[a],A=ee(n!=null?n:[],e,s,r[s]).map((g,H)=>S(S({},g),l==null?void 0:l[H])),C=te[m](A,r),{columns:B,data:G}=ae(C,_,w);return{runs:C.map(g=>g.run),columns:B,data:G}},[n,l,e,m,a,_,w]),U=E(r=>{ne(e.map(s=>`/scalar/data?${F.stringify({run:s.label,tag:t,type:r})}`),e.map(s=>`visualdl-scalar-${s.label}-${t}.${Y[r]}`),`visualdl-scalar-${t}.zip`)},[e,t]);return!D&&W?i.createElement(ie,null,z("common:error")):i.createElement(Q,{title:t,data:D,loading:I,xAxisType:h,xRange:P.x,yRange:P.y,getTooltipTableData:N,downloadData:U})};export default ce;export const Loader=()=>i.createElement(i.Fragment,null,i.createElement(L,T,i.createElement(q,{width:u.width-2,height:u.height-2})),i.createElement(L,T,i.createElement(q,{width:u.width-2,height:u.height-2})));
