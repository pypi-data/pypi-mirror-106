import{useCallback as n,useEffect as y,useLayoutEffect as L,useMemo as b,useRef as a,useState as f}from"../../web_modules/react.js";import{position as S,primaryColor as k,size as T}from"../utils/style.js";import{dataURL2Blob as w}from"../utils/image.js";import{saveFile as j}from"../utils/saveFile.js";import A from"../../web_modules/styled-components.js";import{themes as d}from"../utils/theme.js";import g from"./useTheme.js";const F=t=>{const r=a(null),[o,c]=f(null),u=g(),m=a(t.onInit),x=a(t.onDispose),s=n(()=>o==null?void 0:o.dispatchAction({type:"hideTip"}),[o]),C=n(()=>{(async()=>{if(!r.current)return;const{default:l}=await import("../../web_modules/echarts.js");t.gl&&await import("../../web_modules/echarts-gl.js");const e=l.init(r.current);r.current.addEventListener("mouseleave",s),setTimeout(()=>{if(t.zoom&&e.dispatchAction({type:"takeGlobalCursor",key:"dataZoomSelect",dataZoomSelectActive:!0}),e){var i;(i=m.current)===null||i===void 0||i.call(m,e)}},0),c(e)})()},[t.gl,t.zoom,s]),p=n(()=>{if(o){var l,e;(l=x.current)===null||l===void 0||l.call(x,o),o.dispose(),(e=r.current)===null||e===void 0||e.removeEventListener("mouseleave",s),c(null)}},[s,o]);y(()=>(C(),p),[C,p]),y(()=>{t.loading?o==null||o.showLoading("default",{text:"",color:k,textColor:d[u].textColor,maskColor:d[u].maskColor,zlevel:0}):o==null||o.hideLoading()},[t.loading,u,o]);const h=a(null);L(()=>{if(t.autoFit){const l=h.current;if(l){let e=null;const i=new ResizeObserver(()=>{e!=null&&(cancelAnimationFrame(e),e=null),e=requestAnimationFrame(()=>{o==null||o.resize()})});return i.observe(l),()=>i.unobserve(l)}}},[t.autoFit,o]);const v=n(l=>{if(o){const e=w(o.getDataURL({type:"png",pixelRatio:2,backgroundColor:"#FFF"}));j(e,`${l||"chart"}.png`)}},[o]);return{ref:r,echart:o,wrapper:h,saveAsImage:v}};export default F;export const Wrapper=A.div.withConfig({displayName:"useECharts__Wrapper",componentId:"b4c6ck-0"})(["position:relative;display:flex;justify-content:center;align-items:stretch;> .echarts{width:100%;}> .loading{"," "," display:flex;justify-content:center;align-items:center;}"],T("100%"),S("absolute",0,null,null,0)),useChartTheme=t=>{const r=g(),o=b(()=>d[r],[r]);return b(()=>t?{title:{textStyle:{color:o.textColor}},tooltip:{backgroundColor:o.tooltipBackgroundColor,borderColor:o.tooltipBackgroundColor,textStyle:{color:o.tooltipTextColor}},xAxis3D:{nameTextStyle:{color:o.textLightColor},axisLabel:{color:o.textLightColor},axisLine:{lineStyle:{color:o.borderColor}},splitLine:{lineStyle:{color:o.borderColor}}},yAxis3D:{nameTextStyle:{color:o.textLightColor},axisLabel:{color:o.textLightColor},axisLine:{lineStyle:{color:o.borderColor}},splitLine:{lineStyle:{color:o.borderColor}}},zAxis3D:{nameTextStyle:{color:o.textLightColor},axisLabel:{color:o.textLightColor},axisLine:{lineStyle:{color:o.borderColor}},splitLine:{lineStyle:{color:o.borderColor}}}}:{title:{textStyle:{color:o.textColor}},tooltip:{backgroundColor:o.tooltipBackgroundColor,borderColor:o.tooltipBackgroundColor,textStyle:{color:o.tooltipTextColor}},xAxis:{nameTextStyle:{color:o.textLightColor},axisLabel:{color:o.textLightColor},axisLine:{lineStyle:{color:o.borderColor}},splitLine:{lineStyle:{color:o.borderColor}}},yAxis:{nameTextStyle:{color:o.textLightColor},axisLabel:{color:o.textLightColor},axisLine:{lineStyle:{color:o.borderColor}},splitLine:{lineStyle:{color:o.borderColor}}}},[o,t])};
