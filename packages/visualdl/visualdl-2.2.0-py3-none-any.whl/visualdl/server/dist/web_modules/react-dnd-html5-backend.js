function P(n){var t=null,e=function(){return t==null&&(t=n()),t};return e}function V(n,t){return n.filter(function(e){return e!==t})}function q(n,t){var e=new Set,r=function(o){return e.add(o)};n.forEach(r),t.forEach(r);var a=[];return e.forEach(function(i){return a.push(i)}),a}function G(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")}function k(n,t){for(var e=0;e<t.length;e++){var r=t[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,r.key,r)}}function J(n,t,e){return t&&k(n.prototype,t),e&&k(n,e),n}var Q=function(){function n(t){G(this,n),this.entered=[],this.isNodeInDocument=t}return J(n,[{key:"enter",value:function(e){var r=this,a=this.entered.length,i=function(u){return r.isNodeInDocument(u)&&(!u.contains||u.contains(e))};return this.entered=q(this.entered.filter(i),[e]),a===0&&this.entered.length>0}},{key:"leave",value:function(e){var r=this.entered.length;return this.entered=V(this.entered.filter(this.isNodeInDocument),e),r>0&&this.entered.length===0}},{key:"reset",value:function(){this.entered=[]}}]),n}(),Z=P(function(){return/firefox/i.test(navigator.userAgent)}),_=P(function(){return Boolean(window.safari)});function ee(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")}function x(n,t){for(var e=0;e<t.length;e++){var r=t[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,r.key,r)}}function te(n,t,e){return t&&x(n.prototype,t),e&&x(n,e),n}var M=function(){function n(t,e){ee(this,n);for(var r=t.length,a=[],i=0;i<r;i++)a.push(i);a.sort(function(w,K){return t[w]<t[K]?-1:1});for(var o=[],u=[],s,l,f=0;f<r-1;f++)s=t[f+1]-t[f],l=e[f+1]-e[f],o.push(s),u.push(l/s);for(var c=[u[0]],d=0;d<o.length-1;d++){var v=u[d],h=u[d+1];if(v*h<=0)c.push(0);else{s=o[d];var m=o[d+1],T=s+m;c.push(3*T/((T+m)/v+(T+s)/h))}}c.push(u[u.length-1]);for(var O=[],D=[],p,g=0;g<c.length-1;g++){p=u[g];var S=c[g],E=1/o[g],y=S+c[g+1]-p-p;O.push((p-S-y)*E),D.push(y*E*E)}this.xs=t,this.ys=e,this.c1s=c,this.c2s=O,this.c3s=D}return te(n,[{key:"interpolate",value:function(e){var r=this.xs,a=this.ys,i=this.c1s,o=this.c2s,u=this.c3s,s=r.length-1;if(e===r[s])return a[s];for(var l=0,f=u.length-1,c;l<=f;){c=Math.floor(.5*(l+f));var d=r[c];if(d<e)l=c+1;else if(d>e)f=c-1;else return a[c]}s=Math.max(0,f);var v=e-r[s],h=v*v;return a[s]+i[s]*v+o[s]*h+u[s]*v*h}}]),n}(),re=1;function j(n){var t=n.nodeType===re?n:n.parentElement;if(!t)return null;var e=t.getBoundingClientRect(),r=e.top,a=e.left;return{x:a,y:r}}function I(n){return{x:n.clientX,y:n.clientY}}function ne(n){var t;return n.nodeName==="IMG"&&(Z()||!((t=document.documentElement)!==null&&t!==void 0&&t.contains(n)))}function ae(n,t,e,r){var a=n?t.width:e,i=n?t.height:r;return _()&&n&&(i/=window.devicePixelRatio,a/=window.devicePixelRatio),{dragPreviewWidth:a,dragPreviewHeight:i}}function ie(n,t,e,r,a){var i=ne(t),o=i?n:t,u=j(o),s={x:e.x-u.x,y:e.y-u.y},l=n.offsetWidth,f=n.offsetHeight,c=r.anchorX,d=r.anchorY,v=ae(i,t,l,f),h=v.dragPreviewWidth,m=v.dragPreviewHeight,T=function(){var y=new M([0,.5,1],[s.y,s.y/f*m,s.y+m-f]),w=y.interpolate(d);return _()&&i&&(w+=(window.devicePixelRatio-1)*m),w},O=function(){var y=new M([0,.5,1],[s.x,s.x/l*h,s.x+h-l]);return y.interpolate(c)},D=a.offsetX,p=a.offsetY,g=D===0||D,S=p===0||p;return{x:g?D:O(),y:S?p:T()}}var H="__NATIVE_FILE__",A="__NATIVE_URL__",X="__NATIVE_TEXT__",R="__NATIVE_HTML__",F=Object.freeze({__proto__:null,FILE:H,URL:A,TEXT:X,HTML:R});function C(n,t,e){var r=t.reduce(function(a,i){return a||n.getData(i)},"");return r!=null?r:e}var N;function b(n,t,e){return t in n?Object.defineProperty(n,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):n[t]=e,n}var L=(N={},b(N,H,{exposeProperties:{files:function(t){return Array.prototype.slice.call(t.files)},items:function(t){return t.items}},matchesTypes:["Files"]}),b(N,R,{exposeProperties:{html:function(t,e){return C(t,e,"")}},matchesTypes:["Html","text/html"]}),b(N,A,{exposeProperties:{urls:function(t,e){return C(t,e,"").split(`
`)}},matchesTypes:["Url","text/uri-list"]}),b(N,X,{exposeProperties:{text:function(t,e){return C(t,e,"")}},matchesTypes:["Text","text/plain"]}),N);function oe(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")}function Y(n,t){for(var e=0;e<t.length;e++){var r=t[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,r.key,r)}}function se(n,t,e){return t&&Y(n.prototype,t),e&&Y(n,e),n}var ue=function(){function n(t){oe(this,n),this.config=t,this.item={},this.initializeExposedProperties()}return se(n,[{key:"initializeExposedProperties",value:function(){var e=this;Object.keys(this.config.exposeProperties).forEach(function(r){Object.defineProperty(e.item,r,{configurable:!0,enumerable:!0,get:function(){return console.warn(`Browser doesn't allow reading "`.concat(r,'" until the drop event.')),null}})})}},{key:"loadDataTransfer",value:function(e){var r=this;if(e){var a={};Object.keys(this.config.exposeProperties).forEach(function(i){a[i]={value:r.config.exposeProperties[i](e,r.config.matchesTypes),configurable:!0,enumerable:!0}}),Object.defineProperties(this.item,a)}}},{key:"canDrag",value:function(){return!0}},{key:"beginDrag",value:function(){return this.item}},{key:"isDragging",value:function(e,r){return r===e.getSourceId()}},{key:"endDrag",value:function(){}}]),n}();function le(n,t){var e=new ue(L[n]);return e.loadDataTransfer(t),e}function z(n){if(!n)return null;var t=Array.prototype.slice.call(n.types||[]);return Object.keys(L).filter(function(e){var r=L[e].matchesTypes;return r.some(function(a){return t.indexOf(a)>-1})})[0]||null}function fe(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")}function B(n,t){for(var e=0;e<t.length;e++){var r=t[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,r.key,r)}}function ce(n,t,e){return t&&B(n.prototype,t),e&&B(n,e),n}var de=function(){function n(t,e){fe(this,n),this.ownerDocument=null,this.globalContext=t,this.optionsArgs=e}return ce(n,[{key:"window",get:function(){if(this.globalContext)return this.globalContext;if(typeof window!="undefined")return window}},{key:"document",get:function(){var e;return(e=this.globalContext)!==null&&e!==void 0&&e.document?this.globalContext.document:this.window?this.window.document:void 0}},{key:"rootElement",get:function(){var e;return((e=this.optionsArgs)===null||e===void 0?void 0:e.rootElement)||this.window}}]),n}();function $(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);t&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),e.push.apply(e,r)}return e}function U(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?$(Object(e),!0).forEach(function(r){ve(n,r,e[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):$(Object(e)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(e,r))})}return n}function ve(n,t,e){return t in n?Object.defineProperty(n,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):n[t]=e,n}function ge(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")}function W(n,t){for(var e=0;e<t.length;e++){var r=t[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,r.key,r)}}function he(n,t,e){return t&&W(n.prototype,t),e&&W(n,e),n}var pe=function(){function n(t,e,r){var a=this;ge(this,n),this.sourcePreviewNodes=new Map,this.sourcePreviewNodeOptions=new Map,this.sourceNodes=new Map,this.sourceNodeOptions=new Map,this.dragStartSourceIds=null,this.dropTargetIds=[],this.dragEnterTargetIds=[],this.currentNativeSource=null,this.currentNativeHandle=null,this.currentDragSourceNode=null,this.altKeyPressed=!1,this.mouseMoveTimeoutTimer=null,this.asyncEndDragFrameId=null,this.dragOverTargetIds=null,this.getSourceClientOffset=function(i){var o=a.sourceNodes.get(i);return o&&j(o)||null},this.endDragNativeItem=function(){!a.isDraggingNativeItem()||(a.actions.endDrag(),a.currentNativeHandle&&a.registry.removeSource(a.currentNativeHandle),a.currentNativeHandle=null,a.currentNativeSource=null)},this.isNodeInDocument=function(i){return Boolean(i&&a.document&&a.document.body&&document.body.contains(i))},this.endDragIfSourceWasRemovedFromDOM=function(){var i=a.currentDragSourceNode;i==null||a.isNodeInDocument(i)||a.clearCurrentDragSourceNode()&&a.monitor.isDragging()&&a.actions.endDrag()},this.handleTopDragStartCapture=function(){a.clearCurrentDragSourceNode(),a.dragStartSourceIds=[]},this.handleTopDragStart=function(i){if(!i.defaultPrevented){var o=a.dragStartSourceIds;a.dragStartSourceIds=null;var u=I(i);a.monitor.isDragging()&&a.actions.endDrag(),a.actions.beginDrag(o||[],{publishSource:!1,getSourceClientOffset:a.getSourceClientOffset,clientOffset:u});var s=i.dataTransfer,l=z(s);if(a.monitor.isDragging()){if(s&&typeof s.setDragImage=="function"){var f=a.monitor.getSourceId(),c=a.sourceNodes.get(f),d=a.sourcePreviewNodes.get(f)||c;if(d){var v=a.getCurrentSourcePreviewNodeOptions(),h=v.anchorX,m=v.anchorY,T=v.offsetX,O=v.offsetY,D={anchorX:h,anchorY:m},p={offsetX:T,offsetY:O},g=ie(c,d,u,D,p);s.setDragImage(d,g.x,g.y)}}try{s==null||s.setData("application/json",{})}catch(y){}a.setCurrentDragSourceNode(i.target);var S=a.getCurrentSourcePreviewNodeOptions(),E=S.captureDraggingState;E?a.actions.publishDragSource():setTimeout(function(){return a.actions.publishDragSource()},0)}else if(l)a.beginDragNativeItem(l);else{if(s&&!s.types&&(i.target&&!i.target.hasAttribute||!i.target.hasAttribute("draggable")))return;i.preventDefault()}}},this.handleTopDragEndCapture=function(){a.clearCurrentDragSourceNode()&&a.monitor.isDragging()&&a.actions.endDrag()},this.handleTopDragEnterCapture=function(i){a.dragEnterTargetIds=[];var o=a.enterLeaveCounter.enter(i.target);if(!(!o||a.monitor.isDragging())){var u=i.dataTransfer,s=z(u);s&&a.beginDragNativeItem(s,u)}},this.handleTopDragEnter=function(i){var o=a.dragEnterTargetIds;if(a.dragEnterTargetIds=[],!!a.monitor.isDragging()){a.altKeyPressed=i.altKey,o.length>0&&a.actions.hover(o,{clientOffset:I(i)});var u=o.some(function(s){return a.monitor.canDropOnTarget(s)});u&&(i.preventDefault(),i.dataTransfer&&(i.dataTransfer.dropEffect=a.getCurrentDropEffect()))}},this.handleTopDragOverCapture=function(){a.dragOverTargetIds=[]},this.handleTopDragOver=function(i){var o=a.dragOverTargetIds;if(a.dragOverTargetIds=[],!a.monitor.isDragging()){i.preventDefault(),i.dataTransfer&&(i.dataTransfer.dropEffect="none");return}a.altKeyPressed=i.altKey,a.actions.hover(o||[],{clientOffset:I(i)});var u=(o||[]).some(function(s){return a.monitor.canDropOnTarget(s)});u?(i.preventDefault(),i.dataTransfer&&(i.dataTransfer.dropEffect=a.getCurrentDropEffect())):a.isDraggingNativeItem()?i.preventDefault():(i.preventDefault(),i.dataTransfer&&(i.dataTransfer.dropEffect="none"))},this.handleTopDragLeaveCapture=function(i){a.isDraggingNativeItem()&&i.preventDefault();var o=a.enterLeaveCounter.leave(i.target);!o||a.isDraggingNativeItem()&&setTimeout(function(){return a.endDragNativeItem()},0)},this.handleTopDropCapture=function(i){if(a.dropTargetIds=[],a.isDraggingNativeItem()){var o;i.preventDefault(),(o=a.currentNativeSource)===null||o===void 0||o.loadDataTransfer(i.dataTransfer)}a.enterLeaveCounter.reset()},this.handleTopDrop=function(i){var o=a.dropTargetIds;a.dropTargetIds=[],a.actions.hover(o,{clientOffset:I(i)}),a.actions.drop({dropEffect:a.getCurrentDropEffect()}),a.isDraggingNativeItem()?a.endDragNativeItem():a.monitor.isDragging()&&a.actions.endDrag()},this.handleSelectStart=function(i){var o=i.target;typeof o.dragDrop=="function"&&(o.tagName==="INPUT"||o.tagName==="SELECT"||o.tagName==="TEXTAREA"||o.isContentEditable||(i.preventDefault(),o.dragDrop()))},this.options=new de(e,r),this.actions=t.getActions(),this.monitor=t.getMonitor(),this.registry=t.getRegistry(),this.enterLeaveCounter=new Q(this.isNodeInDocument)}return he(n,[{key:"profile",value:function(){var e,r;return{sourcePreviewNodes:this.sourcePreviewNodes.size,sourcePreviewNodeOptions:this.sourcePreviewNodeOptions.size,sourceNodeOptions:this.sourceNodeOptions.size,sourceNodes:this.sourceNodes.size,dragStartSourceIds:((e=this.dragStartSourceIds)===null||e===void 0?void 0:e.length)||0,dropTargetIds:this.dropTargetIds.length,dragEnterTargetIds:this.dragEnterTargetIds.length,dragOverTargetIds:((r=this.dragOverTargetIds)===null||r===void 0?void 0:r.length)||0}}},{key:"window",get:function(){return this.options.window}},{key:"document",get:function(){return this.options.document}},{key:"rootElement",get:function(){return this.options.rootElement}},{key:"setup",value:function(){var e=this.rootElement;if(e!==void 0){if(e.__isReactDndBackendSetUp)throw new Error("Cannot have two HTML5 backends at the same time.");e.__isReactDndBackendSetUp=!0,this.addEventListeners(e)}}},{key:"teardown",value:function(){var e=this.rootElement;if(e!==void 0&&(e.__isReactDndBackendSetUp=!1,this.removeEventListeners(this.rootElement),this.clearCurrentDragSourceNode(),this.asyncEndDragFrameId)){var r;(r=this.window)===null||r===void 0||r.cancelAnimationFrame(this.asyncEndDragFrameId)}}},{key:"connectDragPreview",value:function(e,r,a){var i=this;return this.sourcePreviewNodeOptions.set(e,a),this.sourcePreviewNodes.set(e,r),function(){i.sourcePreviewNodes.delete(e),i.sourcePreviewNodeOptions.delete(e)}}},{key:"connectDragSource",value:function(e,r,a){var i=this;this.sourceNodes.set(e,r),this.sourceNodeOptions.set(e,a);var o=function(l){return i.handleDragStart(l,e)},u=function(l){return i.handleSelectStart(l)};return r.setAttribute("draggable","true"),r.addEventListener("dragstart",o),r.addEventListener("selectstart",u),function(){i.sourceNodes.delete(e),i.sourceNodeOptions.delete(e),r.removeEventListener("dragstart",o),r.removeEventListener("selectstart",u),r.setAttribute("draggable","false")}}},{key:"connectDropTarget",value:function(e,r){var a=this,i=function(l){return a.handleDragEnter(l,e)},o=function(l){return a.handleDragOver(l,e)},u=function(l){return a.handleDrop(l,e)};return r.addEventListener("dragenter",i),r.addEventListener("dragover",o),r.addEventListener("drop",u),function(){r.removeEventListener("dragenter",i),r.removeEventListener("dragover",o),r.removeEventListener("drop",u)}}},{key:"addEventListeners",value:function(e){!e.addEventListener||(e.addEventListener("dragstart",this.handleTopDragStart),e.addEventListener("dragstart",this.handleTopDragStartCapture,!0),e.addEventListener("dragend",this.handleTopDragEndCapture,!0),e.addEventListener("dragenter",this.handleTopDragEnter),e.addEventListener("dragenter",this.handleTopDragEnterCapture,!0),e.addEventListener("dragleave",this.handleTopDragLeaveCapture,!0),e.addEventListener("dragover",this.handleTopDragOver),e.addEventListener("dragover",this.handleTopDragOverCapture,!0),e.addEventListener("drop",this.handleTopDrop),e.addEventListener("drop",this.handleTopDropCapture,!0))}},{key:"removeEventListeners",value:function(e){!e.removeEventListener||(e.removeEventListener("dragstart",this.handleTopDragStart),e.removeEventListener("dragstart",this.handleTopDragStartCapture,!0),e.removeEventListener("dragend",this.handleTopDragEndCapture,!0),e.removeEventListener("dragenter",this.handleTopDragEnter),e.removeEventListener("dragenter",this.handleTopDragEnterCapture,!0),e.removeEventListener("dragleave",this.handleTopDragLeaveCapture,!0),e.removeEventListener("dragover",this.handleTopDragOver),e.removeEventListener("dragover",this.handleTopDragOverCapture,!0),e.removeEventListener("drop",this.handleTopDrop),e.removeEventListener("drop",this.handleTopDropCapture,!0))}},{key:"getCurrentSourceNodeOptions",value:function(){var e=this.monitor.getSourceId(),r=this.sourceNodeOptions.get(e);return U({dropEffect:this.altKeyPressed?"copy":"move"},r||{})}},{key:"getCurrentDropEffect",value:function(){return this.isDraggingNativeItem()?"copy":this.getCurrentSourceNodeOptions().dropEffect}},{key:"getCurrentSourcePreviewNodeOptions",value:function(){var e=this.monitor.getSourceId(),r=this.sourcePreviewNodeOptions.get(e);return U({anchorX:.5,anchorY:.5,captureDraggingState:!1},r||{})}},{key:"isDraggingNativeItem",value:function(){var e=this.monitor.getItemType();return Object.keys(F).some(function(r){return F[r]===e})}},{key:"beginDragNativeItem",value:function(e,r){this.clearCurrentDragSourceNode(),this.currentNativeSource=le(e,r),this.currentNativeHandle=this.registry.addSource(e,this.currentNativeSource),this.actions.beginDrag([this.currentNativeHandle])}},{key:"setCurrentDragSourceNode",value:function(e){var r=this;this.clearCurrentDragSourceNode(),this.currentDragSourceNode=e;var a=1e3;this.mouseMoveTimeoutTimer=setTimeout(function(){var i;return(i=r.rootElement)===null||i===void 0?void 0:i.addEventListener("mousemove",r.endDragIfSourceWasRemovedFromDOM,!0)},a)}},{key:"clearCurrentDragSourceNode",value:function(){if(this.currentDragSourceNode){if(this.currentDragSourceNode=null,this.rootElement){var e;(e=this.window)===null||e===void 0||e.clearTimeout(this.mouseMoveTimeoutTimer||void 0),this.rootElement.removeEventListener("mousemove",this.endDragIfSourceWasRemovedFromDOM,!0)}return this.mouseMoveTimeoutTimer=null,!0}return!1}},{key:"handleDragStart",value:function(e,r){e.defaultPrevented||(this.dragStartSourceIds||(this.dragStartSourceIds=[]),this.dragStartSourceIds.unshift(r))}},{key:"handleDragEnter",value:function(e,r){this.dragEnterTargetIds.unshift(r)}},{key:"handleDragOver",value:function(e,r){this.dragOverTargetIds===null&&(this.dragOverTargetIds=[]),this.dragOverTargetIds.unshift(r)}},{key:"handleDrop",value:function(e,r){this.dropTargetIds.unshift(r)}}]),n}(),me=function(t,e,r){return new pe(t,e,r)};export{me as HTML5Backend};
