{"version":3,"sources":["webpack:///./app/views/settings/account/accountSecurity/accountSecurityWrapper.tsx"],"names":["ENDPOINT","auth","authId","setState","loading","api","requestPromise","method","remountComponent","addErrorMessage","t","name","props","params","children","this","state","authenticators","organizations","countEnrolled","filter","isEnrolled","isBackupInterface","length","orgsRequire2fa","org","require2FA","deleteDisabled","defined","React","onDisable","handleDisable","onRegenerateBackupCodes","handleRegenerateBackupCodes","AsyncComponent"],"mappings":"+vCASA,IAAMA,EAAW,4BA8EjB,Q,mqBA1DkB,WAAOC,GAAP,oEACTA,GAASA,EAAKC,OADL,wDAKd,EAAKC,SAAS,CAACC,SAAS,IALV,kBAQN,EAAKC,IAAIC,eAAT,UAA2BN,GAA3B,OAAsCC,EAAKC,OAA3C,KAAsD,CAACK,OAAQ,WARzD,OASZ,EAAKC,mBATO,gDAWZ,EAAKL,SAAS,CAACC,SAAS,KACxBK,SAAgBC,OAAE,qBAAsBT,EAAKU,OAZjC,yD,0HAgBc,qFAC5B,EAAKR,SAAS,CAACC,SAAS,IADI,kBAIpB,EAAKC,IAAIC,eAAT,UAA2BN,GAA3B,OAAsC,EAAKY,MAAMC,OAAOX,OAAxD,KAAmE,CACvEK,OAAQ,QALgB,OAO1B,EAAKC,mBAPqB,gDAS1B,EAAKL,SAAS,CAACC,SAAS,KACxBK,SAAgBC,OAAE,oCAVQ,0D,6CAvB9B,WACE,MAAO,CACL,CAAC,iBAAkBV,GACnB,CAAC,gBAAiB,sB,wBAkCtB,WAAa,IACJc,EAAYC,KAAKH,MAAjBE,SADI,EAE6BC,KAAKC,MAAtCC,EAFI,EAEJA,eAAgBC,EAFZ,EAEYA,cAIjBC,IADJF,aAAA,EAAAA,EAAgBG,QAAO,SAAAnB,GAAI,OAAIA,EAAKoB,aAAepB,EAAKqB,uBAAsB,IACjDC,OACzBC,GAAiBN,aAAA,EAAAA,EAAeE,QAAO,SAAAK,GAAG,OAAIA,EAAIC,gBAAe,GACjEC,EAAiBH,EAAeD,OAAS,GAAuB,IAAlBJ,EAKpD,OAAKS,QAAQd,GAINe,eAAmBd,KAAKH,MAAME,SAAU,CAC7CgB,UAAWf,KAAKgB,cAChBC,wBAAyBjB,KAAKkB,4BAC9BhB,iBACAU,iBACAH,iBACAL,kBATO,S,GApDwBe","file":"app_views_settings_account_accountSecurity_accountSecurityWrapper_tsx.656131f3c7270299beab.js","sourcesContent":["import * as React from 'react';\nimport {RouteComponentProps} from 'react-router';\n\nimport {addErrorMessage} from 'app/actionCreators/indicator';\nimport AsyncComponent from 'app/components/asyncComponent';\nimport {t} from 'app/locale';\nimport {Authenticator, OrganizationSummary} from 'app/types';\nimport {defined} from 'app/utils';\n\nconst ENDPOINT = '/users/me/authenticators/';\n\ntype Props = {\n  children: React.ReactElement;\n} & RouteComponentProps<{authId: string}, {}> &\n  AsyncComponent['props'];\n\ntype State = {\n  authenticators?: Authenticator[] | null;\n  organizations?: OrganizationSummary[];\n} & AsyncComponent['state'];\n\nclass AccountSecurityWrapper extends AsyncComponent<Props, State> {\n  getEndpoints(): ReturnType<AsyncComponent['getEndpoints']> {\n    return [\n      ['authenticators', ENDPOINT],\n      ['organizations', '/organizations/'],\n    ];\n  }\n\n  handleDisable = async (auth: Authenticator) => {\n    if (!auth || !auth.authId) {\n      return;\n    }\n\n    this.setState({loading: true});\n\n    try {\n      await this.api.requestPromise(`${ENDPOINT}${auth.authId}/`, {method: 'DELETE'});\n      this.remountComponent();\n    } catch (_err) {\n      this.setState({loading: false});\n      addErrorMessage(t('Error disabling %s', auth.name));\n    }\n  };\n\n  handleRegenerateBackupCodes = async () => {\n    this.setState({loading: true});\n\n    try {\n      await this.api.requestPromise(`${ENDPOINT}${this.props.params.authId}/`, {\n        method: 'PUT',\n      });\n      this.remountComponent();\n    } catch (_err) {\n      this.setState({loading: false});\n      addErrorMessage(t('Error regenerating backup codes'));\n    }\n  };\n\n  renderBody() {\n    const {children} = this.props;\n    const {authenticators, organizations} = this.state;\n\n    const enrolled =\n      authenticators?.filter(auth => auth.isEnrolled && !auth.isBackupInterface) || [];\n    const countEnrolled = enrolled.length;\n    const orgsRequire2fa = organizations?.filter(org => org.require2FA) || [];\n    const deleteDisabled = orgsRequire2fa.length > 0 && countEnrolled === 1;\n\n    // This happens when you switch between children views and the next child\n    // view is lazy loaded, it can potentially be `null` while the code split\n    // package is being fetched\n    if (!defined(children)) {\n      return null;\n    }\n\n    return React.cloneElement(this.props.children, {\n      onDisable: this.handleDisable,\n      onRegenerateBackupCodes: this.handleRegenerateBackupCodes,\n      authenticators,\n      deleteDisabled,\n      orgsRequire2fa,\n      countEnrolled,\n    });\n  }\n}\n\nexport default AccountSecurityWrapper;\n"],"sourceRoot":""}