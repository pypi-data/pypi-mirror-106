(self.webpackChunk_jlab_enhanced_cell_toolbar=self.webpackChunk_jlab_enhanced_cell_toolbar||[]).push([[831],{831:(t,e,s)=>{"use strict";s.r(e),s.d(e,{default:()=>D});var o=s(904),n=s(790),l=s(950),a=s(850),i=s(510),d=s(138);class c extends i.Widget{constructor(t,e){super(),this._commands=t,this.layout=new i.PanelLayout,this.addClass("jp-enh-cell-menu"),this._addButtons(e)}handleEvent(t){switch(t.type){case"mousedown":case"click":t.stopPropagation()}}onAfterAttach(){this.node.addEventListener("mousedown",this),this.node.addEventListener("click",this)}onBeforeDetach(){this.node.removeEventListener("mousedown",this),this.node.removeEventListener("click",this)}_addButtons(t){(0,a.each)(this.children(),(t=>{t.dispose()}));const e=this.layout;t.forEach((t=>{var s,o;this._commands.hasCommand(t.command)&&e.addWidget(new d.ToolbarButton({icon:l.LabIcon.resolve({icon:t.icon}),className:`jp-enh-cell-${null!==(s=t.cellType)&&void 0!==s?s:"all"}`,onClick:()=>{this._commands.execute(t.command)},tooltip:null!==(o=t.tooltip)&&void 0!==o?o:this._commands.label(t.command)}))}))}}var h=s(680);const r="jp-enh-cell-mod-click";class g extends i.Widget{constructor(t){super(),this._model=t,this.layout=new i.PanelLayout,this.addClass("jp-enh-cell-tags"),this._createTagInput(),this._model.stateChanged.connect(this.onTagsModelChanged,this);const e=t.cellModel.metadata.get("tags")||[];e.length>0?t.tags.pushAll(e):this.refreshTags(),t.cellModel.metadata.changed.connect(this.onCellMetadataChanged,this)}dispose(){this.isDisposed||(this._model.cellModel.metadata.changed.disconnect(this.onCellMetadataChanged,this),this._model.stateChanged.disconnect(this.onTagsModelChanged,this),super.dispose())}checkApplied(t){return(this._model.cellModel.metadata.get("tags")||[]).some((e=>e===t))}addTag(t){this._model.unlockedTags||this._refreshOneTag(t);const e=this._model.cellModel.metadata.get("tags")||[],s=t.split(/[,\s]+/).filter((t=>""!==t&&!e.includes(t)));this._model.cellModel.metadata.set("tags",[...e,...s])}removeTag(t){if(!this._model.unlockedTags)return void this._refreshOneTag(t);const e=[...this._model.cellModel.metadata.get("tags")||[]],s=e.indexOf(t);s>-1&&e.splice(s,1),0===e.length?this._model.cellModel.metadata.delete("tags"):this._model.cellModel.metadata.set("tags",e)}refreshTags(){const t=this.layout,e=[...new Set((0,a.toArray)(this._model.tags))],s=[...e].sort(((t,e)=>t>e?1:-1)),o=new Array;t.widgets.forEach((t=>{if("add-tag"!==t.id){const s=e.indexOf(t.name);s<0?o.push(t):e.splice(s,1)}})),o.forEach((t=>t.dispose())),e.forEach((e=>{t.insertWidget(this.layout.widgets.length-1,new h.TagWidget(e))})),[...t.widgets].forEach(((e,o)=>{let n=s.findIndex((t=>e.name===t));-1===n&&(n=s.length),n!==o&&t.insertWidget(n,e)})),t.widgets.forEach((t=>{t.update(),this._model.unlockedTags?(t.show(),t.addClass(r)):"add-tag"!==t.id&&this.checkApplied(t.name)?(t.show(),t.removeClass(r)):t.hide()}))}_createTagInput(){const t=this.layout,e=new h.AddWidget;e.id="add-tag",t.addWidget(e)}_refreshOneTag(t){var e;null===(e=[...this.layout.widgets].find((e=>"add-tag"!==e.id&&e.name===t)))||void 0===e||e.update()}_validateTags(t){const e=new Set;return t.filter((t=>"string"==typeof t&&""!==t)).forEach((t=>{t.split(/[,\s]+/).forEach((t=>{""!==t&&e.add(t)}))})),[...e]}onCellMetadataChanged(t,e){if("tags"===e.key){const t=[...new Set(e.oldValue||[])],s=this._validateTags(e.newValue||[]);t.forEach((t=>{s.includes(t)||this._model.tags.removeValue(t)})),this._model.tags.pushAll(s.filter((e=>!t.includes(e))))}}onTagsModelChanged(){this.refreshTags()}}class p extends i.Widget{constructor(t,e,s,o,n=0){super(),this.layout=new i.PanelLayout,this.addClass("jp-enh-cell-toolbar");const l=new i.Widget;l.addClass("jp-enh-cell-left-space"),l.node.style.width=`${n}px`,this.layout.addWidget(l),this.layout.addWidget(new c(t,s)),this.layout.addWidget(new g(e)),this.layout.addWidget(new c(t,o))}}const m="@jlab-enhanced/cell-toolbar",u=new l.LabIcon({name:`${m}:code`,svgstr:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16px" height="16px">\n    <path d="M0 0h24v24H0V0z" fill="none" />\n    <path class="jp-icon3" fill="#626262" d="M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z" />\n</svg>'}),_=new l.LabIcon({name:`${m}:delete`,svgstr:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16px" height="16px">\n    <path d="M0 0h24v24H0z" fill="none" />\n    <path class="jp-icon3" fill="#626262" d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z" />\n</svg>'}),v=new l.LabIcon({name:`${m}:format`,svgstr:'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" focusable="false" width="16px"\n    height="16px" style="-ms-transform: rotate(360deg); -webkit-transform: rotate(360deg); transform: rotate(360deg);"\n    preserveAspectRatio="xMidYMid meet" viewBox="0 0 1792 1792">\n    <path class="jp-icon3"\n        d="M1473 929q7-118-33-226.5t-113-189t-177-131T929 325q-116-7-225.5 32t-192 110.5t-135 175T317 863q-7 118 33 226.5t113 189t177.5 131T862 1467q155 9 293-59t224-195.5t94-283.5zM1792 0l-349 348q120 117 180.5 272t50.5 321q-11 183-102 339t-241 255.5T999 1660L0 1792l347-347q-120-116-180.5-271.5T116 852q11-184 102-340t241.5-255.5T792 132q167-22 500-66t500-66z"\n        fill="#626262" />\n</svg>'}),w=new l.LabIcon({name:`${m}:lockedtags`,svgstr:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16">\n    <path d="M0 0h24v24H0z" fill="none" />\n    <path class="jp-icon3"\n        d="M9.406 6.862h5.265c1.12-.07 2.047.117 2.632.702 0 0 3.532 2.633 5.265 4.476-1.745 1.793-2.623 2.35-4.387 4.124m-.176 2.457c-.196.193-1.524 1.571-1.755 1.755l-2.983-2.983H3.263c-2.005 0-1.731-.003-1.755-1.755v-7.02c-.025-1.722.059-1.726 2.633-1.756L.98 3.704l1.931-1.579z"\n        fill="#626262" />\n</svg>'}),f=new l.LabIcon({name:`${m}:unlockedtags`,svgstr:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16">\n    <path d="M0 0h24v24H0z" fill="none" />\n    <path class="jp-icon3"\n        d="M14.636 17.27H3.23c-1.772-.06-1.791-.09-1.755-1.756v-7.02c-.026-1.72.001-1.755 1.755-1.755h11.407c1.121-.07 2.048.293 2.633.878 0 0 3.532 2.457 5.265 4.3-1.746 1.793-3.206 2.868-5.265 4.475-.585.585-1.631.887-2.633.877z"\n        fill="#626262" />\n</svg>'});class b extends i.Widget{constructor(t){super({node:T.createNode(t)}),this.addClass("jp-enh-cell-button"),this._callback=t.callback}handleEvent(t){switch(t.type){case"mousedown":this._evtMouseDown(t)}}onBeforeAttach(t){this.node.addEventListener("mousedown",this)}onAfterDetach(t){this.node.removeEventListener("mousedown",this)}_evtMouseDown(t){0===t.button&&(t.preventDefault(),t.stopPropagation(),this._callback())}}var T;!function(t){t.createNode=function(t){const e=document.createElement("button");return t.tooltip&&(e.title=t.tooltip),t.className&&e.classList.add(t.className),e.appendChild(l.LabIcon.resolve({icon:t.icon}).element({elementPosition:"center",elementSize:"normal",tag:"span"})),e}}(T||(T={}));class C extends d.VDomModel{constructor(t,e,s=!1){super(),this._model=t,this._tags=e,this._unlockedTags=s,this._tags.changed.connect(this._emitStateChange,this)}get cellModel(){return this._model}get tags(){return this._tags}get unlockedTags(){return this._unlockedTags}set unlockedTags(t){t!==this._unlockedTags&&(this._unlockedTags=t,this.stateChanged.emit())}dispose(){this.isDisposed||(this._tags.changed.disconnect(this._emitStateChange,this),super.dispose())}_emitStateChange(){this.stateChanged.emit()}}var k=s(271),y=s.n(k);class M extends d.ReactWidget{constructor(t={}){super(),this.props=t,this._toggled=!1,(0,d.addToolbarButtonClass)(this)}get toggled(){return this._toggled}set toggled(t){t!==this._toggled&&(this._toggled=t,this.update())}render(){const t={className:this.props.className?this.props.className(this.toggled):void 0,label:this.props.label?this.props.label(this.toggled):void 0,icon:this.props.icon?this.props.icon(this.toggled):void 0,tooltip:this.props.tooltip?this.props.tooltip(this.toggled):void 0,onClick:this.props.onClick?()=>{this.toggled=!this.toggled,this.props.onClick(this.toggled)}:void 0,enabled:this.props.enabled?this.props.enabled(this.toggled):void 0};return y().createElement(d.ToolbarButtonComponent,Object.assign({},t))}}const x=[{cellType:"markdown",command:"notebook:change-cell-to-code",icon:u},{cellType:"code",command:"notebook:change-cell-to-markdown",icon:l.markdownIcon},{cellType:"code",command:"jupyterlab_code_formatter:format",icon:v,tooltip:"Format Cell"},{command:"notebook:delete-cell",icon:_}],j=[{command:"notebook:run-cell-and-select-next",icon:l.runIcon},{command:"notebook:move-cell-up",icon:l.caretUpEmptyThinIcon},{command:"notebook:move-cell-down",icon:l.caretDownEmptyThinIcon},{command:"notebook:insert-cell-below",icon:l.addIcon}],E="jp-enh-cell-bar";class L{constructor(t,e,s){this._allTags=new n.ObservableList,this._isDisposed=!1,this._previousDefaultTags=new Array,this._tagsModels={},this._commands=e,this._panel=t,this._settings=s,this._unlockTagsButton=new M({className:()=>"jp-enh-cell-nb-button",icon:t=>t?w:f,tooltip:t=>t?"Lock tags":"Unlock tags",onClick:t=>{for(const e in this._tagsModels)this._tagsModels[e].unlockedTags=t}});let o=-1;(0,a.find)(t.toolbar.children(),((t,e)=>(o=e,t.hasClass("jp-Notebook-toolbarCellType")))),t.toolbar.insertItem(o+1,"edit-tags",this._unlockTagsButton),this._settings&&(this._onSettingsChanged(),this._settings.changed.connect(this._onSettingsChanged,this)),this._panel.context.model.cells.changed.connect(this.updateConnectedCells,this)}get isDisposed(){return this._isDisposed}dispose(){var t;if(this.isDisposed)return;this._isDisposed=!0,this._settings&&this._settings.changed.disconnect(this._onSettingsChanged,this);const e=null===(t=this._panel)||void 0===t?void 0:t.context.model.cells;e&&(e.changed.disconnect(this.updateConnectedCells,this),(0,a.each)(e.iter(),(t=>this._removeToolbar(t)))),this._panel=null}updateConnectedCells(t,e){e.oldValues.forEach((t=>this._removeToolbar(t))),e.newValues.forEach((t=>this._addToolbar(t)))}_addToolbar(t){var e;const s=this._getCell(t);if(s){let{helperButtons:o,leftMenu:n,rightMenu:l,leftSpace:a}=null===(e=this._settings)||void 0===e?void 0:e.composite;o=null===o?[]:null!=o?o:j.map((t=>t.command.split(":")[1])),n=null===n?[]:null!=n?n:x,l=null!=l?l:[],a=null!=a?a:0;const i=this._tagsModels[t.id]=new C(t,this._allTags,this._unlockTagsButton.toggled),d=new p(this._commands,i,n,l,a);d.addClass(E),s.layout.insertWidget(0,d),j.filter((t=>o.includes(t.command.split(":")[1]))).forEach((t=>{if(this._commands.hasCommand(t.command)){const{cellType:e,command:o,tooltip:n}=t,l=function(t,e){var s={};for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&e.indexOf(o)<0&&(s[o]=t[o]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(o=Object.getOwnPropertySymbols(t);n<o.length;n++)e.indexOf(o[n])<0&&Object.prototype.propertyIsEnumerable.call(t,o[n])&&(s[o[n]]=t[o[n]])}return s}(t,["cellType","command","tooltip"]),a=o.split(":")[1],i=new b(Object.assign(Object.assign({},l),{callback:()=>{this._commands.execute(o)},className:a&&`jp-enh-cell-${a}`,tooltip:n||this._commands.label(t.command)}));i.addClass(E),i.addClass(`jp-enh-cell-${e||"all"}`),s.layout.addWidget(i)}}))}}_getCell(t){var e;return null===(e=this._panel)||void 0===e?void 0:e.content.widgets.find((e=>e.model===t))}_findToolbarWidgets(t){return t.layout.widgets.filter((t=>t.hasClass(E)))||[]}_removeToolbar(t){const e=this._getCell(t);e&&(this._findToolbarWidgets(e).forEach((t=>t.dispose())),this._tagsModels[t.id]&&(this._tagsModels[t.id].dispose(),delete this._tagsModels[t.id]))}_onSettingsChanged(){var t,e,s;(null===(t=this._panel)||void 0===t?void 0:t.context.model.cells)&&(0,a.each)(null===(e=this._panel)||void 0===e?void 0:e.context.model.cells.iter(),(t=>{this._removeToolbar(t),this._addToolbar(t)}));const o=(null===(s=this._settings)||void 0===s?void 0:s.composite.defaultTags)||[],n=o.filter((t=>!this._previousDefaultTags.includes(t)));n.length>0&&this._allTags.pushAll(n),this._previousDefaultTags.filter((t=>!o.includes(t))).forEach((t=>this._allTags.removeValue(t))),this._previousDefaultTags=o}}class W{constructor(t,e){this._commands=t,this._settings=e}createNew(t){return new L(t,this._commands,this._settings)}}const D={id:`${m}:plugin`,autoStart:!0,activate:async(t,e)=>{var s;const o=null!==(s=await(null==e?void 0:e.load(`${m}:plugin`)))&&void 0!==s?s:null;t.docRegistry.addWidgetExtension("Notebook",new W(t.commands,o))},optional:[o.ISettingRegistry]}}}]);